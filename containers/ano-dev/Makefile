# ── Required version vars ─────────────────────────────────
# These must come from the top-level Makefile (via export) or from
# config.mk (generated by `make configure`).  No local defaults —
# avoids silent drift when building out-of-tree.
-include ../../config.mk

ifndef HOLOSCAN_VER
$(error HOLOSCAN_VER must be set; run from repo root or export it)
endif

_HOLO_TAG       := holo$(HOLOSCAN_VER)
ANO_TOOLS_TAG   ?= ano-tools-$(_HOLO_TAG)

IMAGE_NAME           := ano-dev$(if $(_HOLO_TAG),-$(_HOLO_TAG),)
COMPOSE_SERVICE      := ano-dev
COMPOSE_BUILD_TARGET :=

# Pass version info into Docker build for MOTD
# SDK version args (HOLOSCAN_VER, CUDA_PATCH) are baked into the ano-tools layer.
DOCKER_BUILD_ARGS = \
    --build-arg BASE_IMAGE=$(ANO_TOOLS_TAG) \
    --build-arg CONTAINER_VERSION=$(VER_SEMVER) \
    --build-arg GIT_COMMIT=$(VER_GIT_COMMIT)

include ../../mk/docker-build.mk
include ../../mk/docker-compose.mk

.DEFAULT_GOAL := help

.PHONY: help
help:
	@echo "ano-dev Container"
	@echo ""
	@echo "  docker-build   Build image"
	@echo "  docker-clean   Remove local images"
	@echo "  docker-tags    Print image tags (CI)"
	@echo "  docker-labels  Print OCI labels (CI)"
	@echo ""
	@echo "  compose-up     Start container (run docker-build first if needed)"
	@echo "  compose-down   Stop container"
	@echo "  compose-shell  Shell into container"
	@echo "  compose-logs   Follow logs"
	@echo ""
	@echo "  version-info   Show version"
